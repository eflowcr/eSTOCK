<!-- Modal Overlay -->
<div class="fixed inset-0 z-50 overflow-y-auto" (click)="onBackdropClick($event)">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

    <!-- Center modal -->
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

    <!-- Modal content -->
    <div
      class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"
      (click)="$event.stopPropagation()">
      <!-- Header -->
      <div
        class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
            {{ isEditing ? t('edit_inventory_item') : t('add_inventory_entry') }}
          </h3>
          <button type="button" (click)="close()"
            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-[#3e66ea] focus:ring-offset-2 rounded">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Form Content -->
      <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 max-h-[80vh] overflow-y-auto">
        <form [formGroup]="inventoryForm" (ngSubmit)="onSubmit()" class="space-y-6">

          <!-- Row 1: CODIGO SKU - UBICACION -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- SKU Combobox -->
            <div class="relative">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('sku_code') }} *
              </label>
              <div class="mt-1 relative">
                <input type="text"
                  [disabled]="isEditing"
                  (focus)="!isEditing && (showSkuDropdown = true)"
                  (blur)="onSkuBlur()"
                  [(ngModel)]="skuSearchTerm"
                  (input)="filterArticles()"
                  (keydown.enter)="$event.preventDefault(); confirmFirstArticleIfAny()"
                  [ngModelOptions]="{standalone: true}"
                  placeholder="{{ t('select_sku') }}"
                  [class.bg-gray-100]="isEditing"
                  [class.cursor-not-allowed]="isEditing"
                  [class.dark:bg-gray-600]="isEditing"
                  class="block w-full px-3 py-2 pr-20 border rounded-md shadow-sm focus:outline-none text-[#00113f] dark:bg-gray-700 dark:text-white"
                  [class.border-red-500]="isFieldInvalid('sku') || (skuSearchTerm && !isSkuValid())"
                  [class.border-green-500]="skuSearchTerm && isSkuValid() && !isFieldInvalid('sku')"
                  [class.focus:ring-red-500]="isFieldInvalid('sku') || (skuSearchTerm && !isSkuValid())"
                  [class.focus:border-red-500]="isFieldInvalid('sku') || (skuSearchTerm && !isSkuValid())"
                  [class.focus:ring-green-500]="skuSearchTerm && isSkuValid() && !isFieldInvalid('sku')"
                  [class.focus:border-green-500]="skuSearchTerm && isSkuValid() && !isFieldInvalid('sku')"
                  [class.focus:ring-[#3e66ea]]="!isFieldInvalid('sku') && (!skuSearchTerm || isSkuValid())"
                  [class.focus:border-[#3e66ea]]="!isFieldInvalid('sku') && (!skuSearchTerm || isSkuValid())"
                  [class.border-gray-300]="!isFieldInvalid('sku') && (!skuSearchTerm || isSkuValid())"
                  [class.dark:border-gray-600]="!isFieldInvalid('sku') && (!skuSearchTerm || isSkuValid())"
                />
                <input type="hidden" formControlName="sku" />
                
                <!-- Botones de acción -->
                <div class="absolute inset-y-0 right-0 flex items-center pr-2 space-x-1">
                  <!-- Botón de editar (cuando hay selección válida) -->
                  <button type="button" 
                    *ngIf="hasValidSkuSelection() && !isEditing"
                    (click)="enableSkuEdit()"
                    class="p-1 text-gray-400 hover:text-blue-600 focus:outline-none focus:text-blue-600"
                    [title]="t('edit_selection')">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  </button>
                  
                  <!-- Botón de limpiar -->
                  <button type="button" 
                    *ngIf="(skuSearchTerm || hasValidSkuSelection()) && !isEditing"
                    (click)="clearSkuManually()"
                    class="p-1 text-gray-400 hover:text-red-600 focus:outline-none focus:text-red-600"
                    [title]="t('clear_selection')">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div *ngIf="showSkuDropdown" class="absolute z-10 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md max-h-56 overflow-auto shadow-lg">
                <button type="button" *ngFor="let article of filteredArticles" (mousedown)="$event.preventDefault()" (click)="onSkuSelected(article)"
                  class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-200">
                  {{ article.sku }} - {{ article.name }}
                </button>
                <div *ngIf="filteredArticles.length === 0" class="px-3 py-2 text-sm text-gray-500 dark:text-gray-400">
                  {{ t('no_results') }}
                </div>
              </div>
              <p *ngIf="isFieldInvalid('sku')" class="mt-1 text-sm text-red-600">
                {{ getFieldError('sku') }}
              </p>
              <p *ngIf="!isFieldInvalid('sku') && skuSearchTerm && !isSkuValid()" class="mt-1 text-sm text-amber-600">
                ⚠ {{ t('type_to_search_or_select') }}
              </p>
              <p *ngIf="hasValidSkuSelection()" class="mt-1 text-sm text-green-600">
                ✓ {{ selectedArticle?.name }} - {{ t('selected') }}
              </p>
            </div>

            <!-- Location Combobox -->
            <div class="relative">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('location') }} *
              </label>
              <div class="mt-1 relative">
                <input type="text"
                  [disabled]="isEditing"
                  (focus)="!isEditing && (showLocationDropdown = true)"
                  (blur)="onLocationBlur()"
                  [(ngModel)]="locationSearchTerm"
                  (input)="filterLocations()"
                  (keydown.enter)="$event.preventDefault(); confirmFirstLocationIfAny()"
                  [ngModelOptions]="{standalone: true}"
                  placeholder="{{ t('select_location') }}"
                  [class.bg-gray-100]="isEditing"
                  [class.cursor-not-allowed]="isEditing"
                  [class.dark:bg-gray-600]="isEditing"
                  class="block w-full px-3 py-2 pr-20 border rounded-md shadow-sm focus:outline-none text-[#00113f] dark:bg-gray-700 dark:text-white"
                  [class.border-red-500]="isFieldInvalid('location') || (locationSearchTerm && !isLocationValid())"
                  [class.border-green-500]="locationSearchTerm && isLocationValid() && !isFieldInvalid('location')"
                  [class.focus:ring-red-500]="isFieldInvalid('location') || (locationSearchTerm && !isLocationValid())"
                  [class.focus:border-red-500]="isFieldInvalid('location') || (locationSearchTerm && !isLocationValid())"
                  [class.focus:ring-green-500]="locationSearchTerm && isLocationValid() && !isFieldInvalid('location')"
                  [class.focus:border-green-500]="locationSearchTerm && isLocationValid() && !isFieldInvalid('location')"
                  [class.focus:ring-[#3e66ea]]="!isFieldInvalid('location') && (!locationSearchTerm || isLocationValid())"
                  [class.focus:border-[#3e66ea]]="!isFieldInvalid('location') && (!locationSearchTerm || isLocationValid())"
                  [class.border-gray-300]="!isFieldInvalid('location') && (!locationSearchTerm || isLocationValid())"
                  [class.dark:border-gray-600]="!isFieldInvalid('location') && (!locationSearchTerm || isLocationValid())"
                />
                <input type="hidden" formControlName="location" />
                
                <!-- Botones de acción -->
                <div class="absolute inset-y-0 right-0 flex items-center pr-2 space-x-1">
                  <!-- Botón de editar (cuando hay selección válida) -->
                  <button type="button" 
                    *ngIf="hasValidLocationSelection() && !isEditing"
                    (click)="enableLocationEdit()"
                    class="p-1 text-gray-400 hover:text-blue-600 focus:outline-none focus:text-blue-600"
                    [title]="t('edit_selection')">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                  </button>
                  
                  <!-- Botón de limpiar -->
                  <button type="button" 
                    *ngIf="(locationSearchTerm || hasValidLocationSelection()) && !isEditing"
                    (click)="clearLocationManually()"
                    class="p-1 text-gray-400 hover:text-red-600 focus:outline-none focus:text-red-600"
                    [title]="t('clear_selection')">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div *ngIf="showLocationDropdown" class="absolute z-10 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md max-h-56 overflow-auto shadow-lg">
                <button type="button" *ngFor="let location of filteredLocations" (mousedown)="$event.preventDefault()" (click)="onLocationSelected(location)"
                  class="w-full text-left px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-200">
                  {{ location.location_code }} - {{ location.description }}
                </button>
                <div *ngIf="filteredLocations.length === 0" class="px-3 py-2 text-sm text-gray-500 dark:text-gray-400">
                  {{ t('no_results') }}
                </div>
              </div>
              <p *ngIf="isFieldInvalid('location')" class="mt-1 text-sm text-red-600">
                {{ getFieldError('location') }}
              </p>
              <p *ngIf="!isFieldInvalid('location') && locationSearchTerm && !isLocationValid()" class="mt-1 text-sm text-amber-600">
                ⚠ {{ t('type_to_search_or_select') }}
              </p>
              <p *ngIf="hasValidLocationSelection()" class="mt-1 text-sm text-green-600">
                ✓ {{ inventoryForm.get('location')?.value }} - {{ t('selected') }}
              </p>
            </div>
          </div>

          <!-- Product Information Card -->
          <div *ngIf="hasValidSkuSelection()" class="bg-blue-50 dark:bg-gray-700 rounded-lg p-4 border border-blue-100 dark:border-gray-600">
            <!-- Header -->
            <h3 class="text-sm font-medium text-blue-900 dark:text-blue-200 mb-3">
              {{ t('sku_master_info') }}
            </h3>
            
            <!-- Product Info Row -->
            <div class="flex flex-wrap items-center gap-x-8 gap-y-2">
              <!-- Name -->
              <div class="flex items-center">
                <span class="text-sm font-medium text-blue-700 dark:text-blue-300 mr-2">
                  {{ t('name') }}:
                </span>
                <span class="text-sm text-blue-600 dark:text-blue-400 font-medium">
                  {{ selectedArticle?.name || '-' }}
                </span>
              </div>
              
              <!-- Presentation -->
              <div class="flex items-center">
                <span class="text-sm font-medium text-blue-700 dark:text-blue-300 mr-2">
                  {{ t('presentation') }}:
                </span>
                <span class="text-sm text-blue-600 dark:text-blue-400">
                  {{ selectedArticle?.presentation || '-' }}
                </span>
              </div>
              
              <!-- Unit Price -->
              <div class="flex items-center">
                <span class="text-sm font-medium text-blue-700 dark:text-blue-300 mr-2">
                  {{ t('unit_price') }}:
                </span>
                <span class="text-sm text-blue-600 dark:text-blue-400 font-medium">
                  {{ (selectedArticle?.unit_price | number:'1.2-2') || '0.00' }}
                </span>
              </div>
            </div>
            
            <!-- Tracking Info -->
            <div *ngIf="selectedArticle?.track_by_lot || selectedArticle?.track_by_serial || selectedArticle?.track_expiration" class="mt-3 flex flex-wrap gap-2">
              <span *ngIf="selectedArticle?.track_by_serial" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200">
                Rastreo de Series
              </span>
              <span *ngIf="selectedArticle?.track_by_lot" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                Rastreo de Lotes
              </span>
              <span *ngIf="selectedArticle?.track_expiration" class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200">
                Rastreo por fecha de expiración
              </span>
            </div>
          </div>
          
          <!-- Placeholder when no product selected -->
          <div *ngIf="!hasValidSkuSelection()" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 text-center">
            <p class="text-sm text-gray-500 dark:text-gray-400">
              {{ t('select_sku_to_see_product_info') }}
            </p>
          </div>

          <!-- Row 2: CANTIDAD - ESTADO -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Quantity Input -->
            <div>
              <label for="quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('quantity') }} *
              </label>
              <div class="mt-1 relative">
                <input type="number" id="quantity" formControlName="quantity" min="0" 
                  [readonly]="isEditing"
                  (input)="onQuantityInput()"
                  [class.bg-gray-100]="isEditing"
                  [class.cursor-not-allowed]="isEditing"
                  [class.dark:bg-gray-600]="isEditing"
                  class="block w-full px-3 py-2.5 border rounded-md shadow-sm focus:outline-none text-[#00113f] dark:bg-gray-700 dark:text-white h-10"
                  [class.border-red-500]="isFieldInvalid('quantity')"
                  [class.focus:ring-red-500]="isFieldInvalid('quantity')"
                  [class.focus:border-red-500]="isFieldInvalid('quantity')"
                  [class.focus:ring-[#3e66ea]]="!isFieldInvalid('quantity')"
                  [class.focus:border-[#3e66ea]]="!isFieldInvalid('quantity')"
                  [class.border-gray-300]="!isFieldInvalid('quantity')"
                  [class.dark:border-gray-600]="!isFieldInvalid('quantity')"
                  [placeholder]="t('enter_quantity')" />
                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                  <span class="text-sm text-gray-500 dark:text-gray-400">
                    {{ selectedArticle?.presentation || t('units') }}
                  </span>
                </div>
              </div>
              <p *ngIf="isFieldInvalid('quantity')" class="mt-1 text-sm text-red-600">
                {{ getFieldError('quantity') }}
              </p>
            </div>

            <!-- Status Selection -->
            <div>
              <label for="status" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('status') }} *
              </label>
              <select id="status" formControlName="status" 
                class="mt-1 block w-full px-3 py-2.5 border rounded-md shadow-sm focus:outline-none text-[#00113f] dark:bg-gray-700 dark:text-white h-10"
                [class.border-red-500]="isFieldInvalid('status')"
                [class.focus:ring-red-500]="isFieldInvalid('status')"
                [class.focus:border-red-500]="isFieldInvalid('status')"
                [class.focus:ring-[#3e66ea]]="!isFieldInvalid('status')"
                [class.focus:border-[#3e66ea]]="!isFieldInvalid('status')"
                [class.border-gray-300]="!isFieldInvalid('status')"
                [class.dark:border-gray-600]="!isFieldInvalid('status')">
                <option value="">{{ t('select_status') }}</option>
                <option *ngFor="let option of statusOptions" [value]="option.value">
                  {{ t(option.label) }}
                </option>
              </select>
              <p *ngIf="isFieldInvalid('status')" class="mt-1 text-sm text-red-600">
                {{ getFieldError('status') }}
              </p>
            </div>
          </div>

          <!-- Tracking Information Section - Only show if article supports it -->
          <div *ngIf="inventoryForm.get('trackByLot')?.value || inventoryForm.get('trackBySerial')?.value"
            class="border-t border-gray-200 dark:border-gray-700 pt-6">
            <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
              {{ t('tracking_information') }}
            </h4>

            <!-- Campos de seguimiento (Lotes y Series) en 2 columnas -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              
              <!-- Lot Numbers Column -->
              <div *ngIf="inventoryForm.get('trackByLot')?.value" class="form-group">
                <div class="flex items-center justify-between mb-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                    {{ t('lot_numbers') }} 
                    <span class="ml-1 text-xs" 
                          [class.text-green-600]="isLotSelectionComplete()"
                          [class.text-orange-600]="!isLotSelectionComplete() && getSelectedLotCount() > 0"
                          [class.text-gray-500]="getSelectedLotCount() === 0">
                      ({{ getSelectedLotCount() }}/{{ getExpectedQuantity() }})
                    </span>
                  </label>
                </div>
                
                <div class="relative" *ngIf="!isLotSelectionComplete() && !isEditing">
                  <input type="text"
                    [(ngModel)]="lotSearchTerm"
                    (keydown.enter)="$event.preventDefault(); handleLotEnter()"
                    [ngModelOptions]="{standalone: true}"
                    placeholder="Escribir número de lote y presionar Enter"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#3e66ea] focus:border-[#3e66ea] text-[#00113f] dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                  <input type="hidden" formControlName="lot_numbers" />
                </div>
                
                <!-- Read-only message for edit mode -->
                <div *ngIf="isEditing && getSelectedLots().length > 0" class="text-sm text-gray-600 dark:text-gray-400 italic">
                  {{ t('lots_readonly_edit_mode') || 'Lotes cargados desde inventario existente (solo lectura)' }}
                </div>
                
                <!-- Mensaje cuando está completo -->
                <div *ngIf="isLotSelectionComplete()" class="text-sm text-green-600 dark:text-green-400 font-medium">
                  {{ t('lot_selection_complete') }}
                </div>
                
                
                <!-- Selected lots display -->
                <div *ngIf="getSelectedLots().length > 0" class="mt-2">
                  <div class="flex flex-wrap gap-1">
                    <span *ngFor="let lot of getSelectedLots()" 
                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">
                      {{ lot }}
                      <button type="button" *ngIf="!isEditing" (click)="removeLot(lot)" class="ml-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200">
                        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                      </button>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Serial Numbers Column -->
              <div *ngIf="inventoryForm.get('trackBySerial')?.value" class="form-group">
                <div class="flex items-center justify-between mb-2">
                  <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                    {{ t('serial_numbers') }}
                    <span class="ml-1 text-xs" 
                          [class.text-green-600]="isSerialSelectionComplete()"
                          [class.text-orange-600]="!isSerialSelectionComplete() && getSelectedSerialCount() > 0"
                          [class.text-gray-500]="getSelectedSerialCount() === 0">
                      ({{ getSelectedSerialCount() }}/{{ getExpectedQuantity() }})
                    </span>
                  </label>
                </div>
                
                <div class="relative" *ngIf="!isSerialSelectionComplete() && !isEditing">
                  <input type="text"
                    [(ngModel)]="serialSearchTerm"
                    (keydown.enter)="$event.preventDefault(); handleSerialEnter()"
                    [ngModelOptions]="{standalone: true}"
                    placeholder="Escribir número de serie y presionar Enter"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#3e66ea] focus:border-[#3e66ea] text-[#00113f] dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                  <input type="hidden" formControlName="serial_numbers" />
                </div>
                
                <!-- Read-only message for edit mode -->
                <div *ngIf="isEditing && getSelectedSerials().length > 0" class="text-sm text-gray-600 dark:text-gray-400 italic">
                  {{ t('serials_readonly_edit_mode') || 'Series cargadas desde inventario existente (solo lectura)' }}
                </div>
                
                <!-- Mensaje cuando está completo -->
                <div *ngIf="isSerialSelectionComplete()" class="text-sm text-green-600 dark:text-green-400 font-medium">
                  {{ t('serial_selection_complete') }}
                </div>
                
                
                <!-- Selected serials display -->
                <div *ngIf="getSelectedSerials().length > 0" class="mt-2">
                  <div class="flex flex-wrap gap-1">
                    <span *ngFor="let serial of getSelectedSerials()" 
                      class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                      {{ serial }}
                      <button type="button" *ngIf="!isEditing" (click)="removeSerial(serial)" class="ml-1 text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-200">
                        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                      </button>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Comentado temporalmente: URL de imagen y cantidades max/min -->
          <!--
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <label for="image_url" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('image_url') }}
              </label>
              <input
                type="url"
                id="image_url"
                formControlName="image_url"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#3e66ea] focus:border-[#3e66ea] text-[#00113f] dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"
                [placeholder]="t('enter_image_url')"
              />
            </div>

            <div>
              <label for="min_quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('min_quantity') }}
              </label>
              <input
                type="number"
                id="min_quantity"
                formControlName="min_quantity"
                min="0"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#3e66ea] focus:border-[#3e66ea] text-[#00113f] dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"
                [placeholder]="t('enter_min_quantity')"
              />
            </div>

            <div>
              <label for="max_quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                {{ t('max_quantity') }}
              </label>
              <input
                type="number"
                id="max_quantity"
                formControlName="max_quantity"
                min="0"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#3e66ea] focus:border-[#3e66ea] text-[#00113f] dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:placeholder-gray-400"
                [placeholder]="t('enter_max_quantity')"
              />
            </div>
          </div>
          -->
        </form>
      </div>

      <!-- Footer -->
      <div
        class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200 dark:border-gray-600">
        <button type="button" (click)="onSubmit()" [disabled]="isSubmitting || inventoryForm.invalid"
          class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-[#3e66ea] text-base font-medium text-white hover:bg-[#2d5bd9] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3e66ea] sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed">
          <svg *ngIf="isSubmitting" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
            </path>
          </svg>
          {{ isSubmitting ? t('saving') : (isEditing ? t('update') : t('create')) }}
        </button>
        <button type="button" (click)="onCancel()"
          class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#3e66ea] sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700">
          {{ t('cancel') }}
        </button>
      </div>
    </div>
  </div>
</div>